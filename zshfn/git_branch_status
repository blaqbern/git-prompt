autoload blue yellow magenta

no_git=∅ # U+2205
ahead=ᐃ # U+1403
behind=ᐁ # U+1401

function compare_local_and_remote_refs () {
  if [[ -n $(git ls-remote --refs origin $2) ]]; then
    local_ref=$(git rev-parse $1 2> /dev/null)
    remote_ref=$(git rev-parse origin/$2 2> /dev/null)

    if [[ $local_ref != $remote_ref ]]; then
      merge_base=$(git merge-base $local_ref $remote_ref 2> /dev/null)

      if [[ $remote_ref == $merge_base ]]; then
        echo "$ahead "
      elif [[ $local_ref == $merge_base ]]; then
        echo "$behind "
      else
        echo "$ahead$behind "
      fi
    fi
  fi
}

if [[ -a .git ]]; then
  branch_string=$(git branch 2> /dev/null | grep '*')
  current_branch=$branch_string[(w)2]

  branches=$(git branch 2> /dev/null)
  if [[ $branches =~ main ]]; then
    main_branch="main"
  elif [[ $branches =~ master ]]; then
    main_branch="master"
  elif [[ $branches =~ develop ]]; then
    main_branch="develop"
  fi

  git fetch origin --dry-run 2> /dev/null

  current_vs_remote_current=$(compare_local_and_remote_refs $current_branch $current_branch)
  current_vs_remote_main=$(compare_local_and_remote_refs $current_branch $main_branch)

  echo "$(magenta $current_vs_remote_current)$(blue $current_vs_remote_main)"
else
  echo $(yellow $no_git)
fi

